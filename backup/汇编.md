# 基本语法

汇编程序可以分为三个段

* data段
* bss段
* text段

## data段

数据段被用于声明初始化的数据或常数。此数据在运行时不会更改。可以在段中声明各种常用值，文件名或缓冲区大小等。

```nasm
section.data
```

## bss段

在bss声明变量。

```nasm
section.bss


```

## text段

代码段被用于保持实际的代码。该段必须以全集声明_start开头，该声明告诉内核程序从何处开始执行。

```nasm
section.test
    global _start
_start:
```

## 注释

汇编语言注释以分号(;)开头。它可以包含任何可打印字符，包括空格。它可以单独出现在一行上。

```nasm
;该程序在屏幕上显示一条信息
```

或者，与指令在同一行上。

```nasm
add eax, ebx ;加上ebx的值到eax
```

## 汇编语言声明

汇编语言程序包含三种类型的语句

* 可执行指令或说明
* 汇编程序指令或伪操作
* 宏

可执行指令或简单的指令告诉处理器做什么。每个指令由一个操作码组成。每个可执行指令生成一个机器语言指令。该汇编指令或位操作讲述装配过程中的各方面的汇编。这些是不可执行的，不会生成机器语言指令。宏是一种代码替换机制。

## 汇编语言语句的语法

汇编语言语句每行输入一个语句。每个语句遵循一下格式

```nasm
[label] mnemonic [operands] [;comment]
```

基本命令包括两段，第一段是要执行的指令（或助记符）的名称，第二段是命令的操作数或参数。以下是一些典型汇编语句的示例

```nasm
inc count         ; 增加内存变量count
mov total, 48     ; 将值48转移到内存变量total
add ah,bh         ; 将寄存器BH内容添加到ah寄存器
and mask1, 128    ; 对变量mask1 和 128执行and操作

add marks, 10     ; 将10加到变量marks
mov al, 10        ; 将值10传送到al寄存器
```

## 汇编语言的Hello World 程序

```nasm
section .text
	global _start
_start:
	mov edx,len	; message length
	mov ecx,msg	; message to write
	mov ebx,1	; file descriptor(stdout)
	mov eax,4	; system call number(sys_write)
	int 0x80	; call kernel

	mov eax,1	; system call number(sys)
	int 0x80	; call kernel

section .data
msg db 'Hello, world!', 0xa	;string to be printed
len equ $ - msg			;length of the string

```

在NASM中编译和链接程序

```shell
nasm -f elf hello.asm
# 链接目标文件
ld -m elf_i386 -s -o hello hello.o
```



# 汇编语言 内存段

## 内存段

如果将section 关键字替换为segment，也会得到相同的结果。

```nasm
segment .text      ;code segment
   global _start    ;must be declared for linker 
      
_start:            ;tell linker entry point
   mov edx,len     ;message length
   mov ecx,msg     ;message to write
   mov ebx,1       ;file descriptor (stdout)
   mov eax,4       ;system call number (sys_write)
   int 0x80        ;call kernel

   mov eax,1       ;system call number (sys_exit)
   int 0x80        ;call kernel

segment .data      ;data segment
msg     db 'Hello, world!',0xa   ;our dear string
len     equ     $ - msg          ;length of our dear string
```

## 内存段

分段存储器模型将系统存储器分为独立的分段组，这些分段由位于分段寄存器中的指针引用。每个段用于包含特定类型的数据。一个段用于包含指令代码，另一段用于存储数据元素，第三段保留程序堆栈。

* 数据段 由.data段和.bss段表示。.data节用于声明存储区，在该存储区中为程序存储了数据元素。声明数据元素后，无法扩展此部分，并且在整个程序中他保持静态。.bss部分也是一个静态内存部分，它包含缓冲区，供稍后在程序中声明的数据使用。这个缓冲区内存是零填充的
* 代码段 由.text部分表示。这在内存中定义了一个存储指令代码的区域。这也是一个固定区域
* 堆栈 该段包含传递给程序中的函数和过程的数据值


# 寄存器

## 寄存器

处理器操作主要涉及到处理数据。该数据可以存储在存储器中并从其访问。从存储器中读取数据中将数据存储到存储器中会减慢处理器的速度，因为这涉及到通过控制总线发送数据请求并进入存储器存储单元并通过同意通道获取数据的复杂过程。

为了加速处理器的运行，处理器包括一些内存处理器存储位置，称为寄存器。寄存器存储



# 内存复制

# 堆栈指令


# 汇编如何写函数


# 堆栈传参


# 堆栈平衡


参考文档: 
[简明 x86 汇编指南](https://arthurchiao.art/blog/x86-asm-guide-zh/)
[汇编基础语法 菜鸟学院](https://cainiaoya.com/assemblylanguage/assembly-language-jiaocheng.html)